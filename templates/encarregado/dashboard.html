{% extends "base.html" %}
{% block content %}
<h2>Dashboard do Encarregado</h2>

<!-- Abas -->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Visão Geral</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tempo-tab" data-bs-toggle="tab" data-bs-target="#tempo" type="button" role="tab" aria-controls="tempo" aria-selected="false">Tempo de Empresa</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="frequencia-tab" data-bs-toggle="tab" data-bs-target="#frequencia" type="button" role="tab" aria-controls="frequencia" aria-selected="false">Frequência</button>
  </li>
</ul>

<div class="tab-content" id="myTabContent">
  <!-- Aba Visão Geral -->
  <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
    <div class="row mt-3">
      <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
          <div class="card-header">Usuários Pendentes</div>
          <div class="card-body">
            <h5 class="card-title">{{ pendentes }}</h5>
            <a href="{% url 'usuario_list' %}" class="btn btn-light">Ver pendentes</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
          <div class="card-header">Ativos Trabalhando Hoje</div>
          <div class="card-body">
            <h5 class="card-title">{{ ativos_hoje }}</h5>
            {% if chamada_hoje %}
              <a href="{% url 'chamada_detail' chamada_hoje.id %}" class="btn btn-light">Ver chamada</a>
            {% else %}
              <p>Nenhuma chamada hoje.</p>
              <a href="{% url 'chamada_create' %}" class="btn btn-light">Criar chamada</a>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card mb-3">
          <div class="card-header">Usuários por Setor</div>
          <div class="card-body">
            <ul class="list-group">
              {% for setor in setores %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ setor.setor }}
                  <span class="badge bg-primary rounded-pill">{{ setor.total }}</span>
                </li>
              {% empty %}
                <li class="list-group-item">Nenhum setor cadastrado</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Aba Tempo de Empresa -->
  <div class="tab-pane fade" id="tempo" role="tabpanel" aria-labelledby="tempo-tab">
    <div class="mt-3">
      <h4>Tempo de Empresa (ativos)</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Usuário</th>
            <th>Data de Contratação</th>
            <th>Tempo (anos/meses)</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios_tempo %}
            <tr>
              <td>{{ usuario.nome }}</td>
              <td>{{ usuario.data_contratacao|date:"d/m/Y" }}</td>
              <td>{{ usuario.tempo_anos }} anos e {{ usuario.tempo_meses }} meses</td>
            </tr>
          {% empty %}
            <tr><td colspan="3">Nenhum usuário ativo encontrado.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Aba Frequência de Presença -->
  <div class="tab-pane fade" id="frequencia" role="tabpanel" aria-labelledby="frequencia-tab">
    <div class="mt-3">
      <h4>Frequência nos últimos 30 dias</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Usuário</th>
            <th>Dias Presentes</th>
            <th>Total de Dias</th>
            <th>Percentual</th>
          </tr>
        </thead>
        <tbody>
          {% for item in frequencias %}
            <tr>
              <td>{{ item.nome }}</td>
              <td>{{ item.presentes }}</td>
              <td>{{ item.total_dias }}</td>
              <td>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: {{ item.percentual }}%;" aria-valuenow="{{ item.percentual }}" aria-valuemin="0" aria-valuemax="100">{{ item.percentual }}%</div>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="4">Nenhum dado de frequência disponível.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}